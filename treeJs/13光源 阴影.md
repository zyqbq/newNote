所有的光的基类是light

## 聚光源SpotLight

环境光不会产生阴影

点光源、聚光圆、平行光有方向

![img](http://www.webgl3d.cn/imgthreejs/%E5%85%89%E6%BA%90.png)

![img](http://www.webgl3d.cn/imgthreejs/%E5%85%89%E6%BA%90%E7%A4%BA%E6%84%8F%E5%9B%BE.png)

```javascript
// 聚光源
// 0xffffff:光源颜色
// 1.0：光照强度intensity
const spotLight = new THREE.SpotLight(0xffffff,1.0);

spotLight.intensity = 1.0;//光照强度 光照都有 这个属性
// 设置聚光光源发散角度
spotLight.angle = Math.PI / 6;//光锥角度的二分之一
// 设置聚光光源位置
spotLight.position.set(0, 50, 0);
// spotLight.target是一个模型对象Object3D，默认在坐标原点
spotLight.target.position.set(50,0,0);

scene.add(spotLight);//光源添加到场景中
```



target是一个object3D对象，设置一个空对象添加到场景中是不会显示出来的

```js
spotlight.target=mesh2//指向某个物体
```

![image-20230821203903411](../../assests/image-20230821203903411.png)

方法二，直接设置target，不添加到场景中不会更新位置

![image-20230821204159408](../../assests/image-20230821204159408.png)

#### 聚光源辅助对象`SpotLightHelper`

```javascript
// 聚广源辅助对象，可视化聚广源
const spotLightHelper = new THREE.SpotLightHelper(spotLight,0xffffff)
scene.add(spotLightHelper);
```

### 平行光

有位置和方向属性，但是位置不是决定光线的位置，只是因为两点确定方向

![image-20230821203041654](../../assests/image-20230821203041654.png)

# 设置阴影

都是lightShadow的子类

```javascript
// 设置产生投影的网格模型
mesh.castShadow = true;
```

```javascript
// 平行光 开启光源阴影
const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
// 平行光设置产生阴影的光源对象,开启光源阴影的计算功能
directionalLight.castShadow = true;
```

```javascript
// 设置接收阴影的投影面
planeMesh.receiveShadow = true;
```

```javascript
// 设置渲染器，允许光源阴影渲染
renderer.shadowMap.enabled = true; 
```

#### 平行光阴影相机属性`.shadow.camera`(阴影渲染范围)

是正投影相机，聚光光源是透视相机

```javascript
// 查看平行光阴影相机属性
console.log('阴影相机属性',directionalLight.shadow.camera);
```

平行光阴影相机可视化

`THREE.CameraHelper`可以用来可视化正投影相机、透视投影相机对象。

```js
// 可视化平行光阴影对应的正投影相机对象
const cameraHelper = new THREE.CameraHelper(directionalLight.shadow.camera);
scene.add(cameraHelper);

console.log('shadow.camera位置',directionalLight.shadow.camera.position);
```

```javascript
OrthographicCamera( left, right, top, bottom, near, far )
```

![img](http://www.webgl3d.cn/imgthreejs/%E6%AD%A3%E6%8A%95%E5%BD%B1%E5%8F%AF%E8%A7%86%E7%A9%BA%E9%97%B4.png)

`.shadow.camera`作用是约束三维场景阴影计算范围，上下左右前后六个属性定义了一个长方体空间，在这个长方体空间内容的模型进行阴影计算

```javascript
// 设置三维场景计算阴影的范围
directionalLight.shadow.camera.left = -50;
directionalLight.shadow.camera.right = 50;
directionalLight.shadow.camera.top = 200;
directionalLight.shadow.camera.bottom = -100;
directionalLight.shadow.camera.near = 0.5;
directionalLight.shadow.camera.far = 600;
```

平行光相机的位置`.position`和平行光的一致

### 阴影.mapSize和.radius阴影模糊

`light.shadow.mapSize`阴影贴图尺寸属性(提升边缘渲染效果)尺寸一般2的n次方 渲染质量

同时`.shadow.camera`尽可能小来提升渲染效果

```javascript
// mapSize属性默认512x512
console.log('阴影默认像素',directionalLight.shadow.mapSize);
directionalLight.shadow.mapSize.set(128,128)
```

`light.shadow.radius`弱化模糊阴影边缘 默认是1

```js
directionalLight.shadow.radius = 3;
```

### 工厂案例

一般三维场景需要添加环境光  环境贴图

#### 平行光模拟太阳光

```javascript
const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
directionalLight.position.set(100, 60, 50);
scene.add(directionalLight);

// 参数2表示平行光.position附近方框的尺寸
const dirHelper = new THREE.DirectionalLightHelper( directionalLight, 5);
//更新平行光辅助对象
dirHelper.update();

scene.add( dirHelper );
```

### 阴影条纹问题解决`.shadowMap.type`

```javascript
// 模型表面产生条纹影响渲染效果，可以改变.shadowMap.type默认值优化
renderer.shadowMap.type = THREE.VSMShadowMap; 
```

```js
shadowFolder.add(cam,'left',-500,0).onChange(function(v){
    cam.updateProjectionMatrix();//相机更新投影矩阵
    cameraHelper.update();//相机范围变化了，相机辅助对象更新
});
```

### 光照原理

漫反射光的颜色=几何体表面基色x光线颜色x光线入射角余弦值
夹角通过光线方向向量、顶点法向量可以计算出来