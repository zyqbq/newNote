# 欧拉角Euler

[欧拉角 (opens new window)](https://baike.baidu.com/item/欧拉角/1626212?fr=aladdin)`Euler`是用来表述空间姿态角度的一种数学工具

```javascript
//创建一个欧拉角对象，表示绕x轴旋转60度
const Euler = new THREE.Euler();
Euler.x = Math.PI / 3  绕x轴旋转60度
// 复制欧拉角的值，赋值给物体的.rotation属性
fly.rotation.copy(Euler);
```

模型对象.rotation属性值就是欧拉角

```javascript
// 物体fly绕x轴旋转60度
fly.rotation.x = Math.PI / 3;
```

### 物体旋转顺序`.order`

默认顺序是'XYZ'

```javascript
const Euler = new THREE.Euler();
//先绕X轴旋转，在绕Y、Z轴旋转
Euler.order = 'XYZ';
Euler.x = Math.PI / 3;//写多个会覆盖前面的
Euler.y = Math.PI / 3;
```

# 四元数

绕自身的某轴旋转

.setFromAxisAngle生成四元数

.applyQuaternion应用四元数旋转

```javascript
const quaternion = new THREE.Quaternion();
// 旋转轴new THREE.Vector3(0,0,1)
// 旋转角度Math.PI/2
// 绕z轴旋转90度
setFromAxisAngle生成表示特定旋转的四元数
quaternion.setFromAxisAngle(new THREE.Vector3(0,0,1),Math.PI/2);
// 通过四元数旋转A点：把A点绕z轴旋转90度生成一个新的坐标点B
const B = A.clone().applyQuaternion(quaternion);
```

物体应用四元数

```javascript
//quaternion表示旋转角度复制给物体.quaternion
fly.quaternion.copy(quaternion);
```

`欧拉角和四元数会同步改变，都是绕自身旋转`

四元数乘法.multiply

`A.multiply(B)`表示A乘以B，结果赋值给A，在A的基础上旋转B。

`A.copy(B)`表示用B的值替换A的值，A表示的旋转会被B替换。

```javascript
// 在物体原来姿态基础上，进行旋转
const q1 = new THREE.Quaternion();
q1.setFromAxisAngle(new THREE.Vector3(1, 0, 0), Math.PI / 2);
自身的四元数乘q1
fly.quaternion.multiply(q1);
// 在物体上次旋转基础上，进行旋转
const q2 = new THREE.Quaternion();
q2.setFromAxisAngle(new THREE.Vector3(0, 1, 0), Math.PI / 2);
fly.quaternion.multiply(q2);
// 在物体上次旋转基础上，进行旋转
const q3 = new THREE.Quaternion();
q3.setFromAxisAngle(new THREE.Vector3(0, 0, 1), Math.PI / 2);
fly.quaternion.multiply(q3);
```

### `.setFromUnitVectors(a, b)`

四元数`Quaternion`的方法`.setFromUnitVectors(a, b)`可以通过两个向量参数a和b，创建一个四元数，表示从向量a表示的方向旋转到向量b表示的方向。(参数a, b是单位向量)

```javascript
//飞机初始姿态飞行方向a
const a = new THREE.Vector3(0, 0, -1);
// 飞机姿态绕自身坐标原点旋转到b指向的方向
const b = new THREE.Vector3(-1, -1, -1).normalize();
// a旋转到b构成的四元数
const quaternion = new THREE.Quaternion();
//注意两个参数的顺序
quaternion.setFromUnitVectors(a, b);//a旋转到b
// quaternion表示的是变化过程，在原来基础上乘以quaternion即可
fly.quaternion.multiply(quaternion);
```

### .[setFromAxisAngle](https://threejs.org/docs/index.html#api/zh/math/Quaternion.setFromAxisAngle) ( axis : [Vector3](https://threejs.org/docs/index.html#api/zh/math/Vector3), angle : Float ) : this

从由 [axis](https://threejs.org/docs/index.html#api/zh/math/Vector3)（轴） 和 angle（角度）所给定的旋转来设置该四元数。
改编自 [here](http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm) 所述的方法。
假定**Axis**已被归一化，**angle**以弧度来表示

```js
rot.setFromAxisAngle(new Vector3(0, 0, 1), Math.PI / 2)
```

### 欧拉角万向锁死

欧拉角是记录旋转姿态的

设欧拉角的旋转是以xyz旋转

比如绕x轴旋转30度，绕y旋转90度，绕z旋转40度

这次旋转完成是一次欧拉旋转，

在这次的旋转中绕x轴和绕z轴旋转的维度是一样的，失去了一个自由度，也就是万向锁死现象

都是以初始的世界坐标系作为参考（因为世界坐标和本地坐标重合的）

在这次的旋转中绕z轴旋转是以初始的坐标轴为参考的，不是以旋转了x和y轴的本地坐标为参考的，所有会存在绕z轴旋转时z轴和绕x轴旋转时的轴向一致，也就是本地坐标还没更新，因为处在一次旋转中

所以一次旋转中的第二个旋转值应该避免90度及其倍数

### 欧拉角和四元数的区别

欧拉角的一次旋转会绕自身的坐标系旋转

四元数是绕特定的轴旋转，如世界坐标轴

四元数的乘法能方便的进行变换

