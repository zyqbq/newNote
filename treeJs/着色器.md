### 几个矩阵

- 以下3个变量可以直接使用，threejs的ShaderMaterial已经定义了

modelMatrix 模型矩阵 包含一个几何体的旋转、平移、缩放变换。

viewMatrix 视图矩阵

projectionMatrix 投影矩阵 这些矩阵都改变的是相机的参数



attribute:属性 和顶点位置数据 顶点法向量数据
uniform:统一 光源位置 光源颜色 

varying 声明顶点颜色



### 对应关系 

颜色对应 vec3

四维矩阵mat matrix4;

[Uniform](http://www.yanhuangxueyuan.com/threejs/docs/index.html#api/core/Uniform)

## 属性`.uniforms`使用案例

uniforms写在ShaderMaterial中

uniform写在片元着色器和顶点着色器中，



片元着色器中通过uniform关键字声明了一个颜色变量color，为了给该变量传递数据在ShaderMaterial对象的uniforms属性中定义了一个名为color的属性，按照Three.js系统uniform变量数据自动传递的机制，如果你在着色器代码中自定义声明了多个uniform变量，只要名字和ShaderMaterial对象中uniform数据的名字保持一直就可以正确完成数据传递。

```JavaScript
<!-- 片元着色器 -->
<script id="fragmentShader" type="x-shader/x-fragment">
  // color变量数据来自ShaderMaterial的uniforms属性的color属性
  uniform vec3 color;
  void main() {
 // gl_FragColor = vec4(1.0,0.0,0.0,1.0);
 gl_FragColor = vec4(color,1.0);
  }
</script>
```

ShaderMaterial的uniforms属性代码

```JavaScript
var material = new THREE.ShaderMaterial({
  //定义uniforms属性，uniforms的属性和着色器中的uniform变量相对应
  uniforms:{
// 颜色属性clor对应片元着色器代码中uniform声明的color变量
color:{value:new THREE.Color(0xff0000)}
  },
  // 顶点着色器
  vertexShader: document.getElementById('vertexShader').textContent,
  // 片元着色器
  fragmentShader: document.getElementById('fragmentShader').textContent,
    //以顶点颜色为准进行渲染
      vertexColors: THREE.VertexColors,
    // 双面可见
      side:THREE.DoubleSide,
});
```

```js
const shaderMaterial = new THREE.ShaderMaterial({
  // 顶点着色器
  vertexShader: `
        void main(){
            gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4( position, 1.0 ) ;
        }
    `,//主函数，返回为空
    //片元着色器，这里设置颜色
  fragmentShader: `
        void main(){
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
        }
  `,
});
const floor = new THREE.Mesh(
  new THREE.PlaneBufferGeometry(1, 1, 64, 64),
  shaderMaterial
);
```

### 安装vsc插件

Shader languages support for Vs code

### 导入着色器文件

![image-20221107182307900](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221107182307900.png)

```js
// 顶点着色器
import basicVertexShader from "../shader/basic/vertex.glsl";
// 片元着色器
import basicFragmentShader from "../shader/basic/fragment.glsl";
```

使用着色器

```js
const shaderMaterial = new THREE.ShaderMaterial({
  // 顶点着色器
  vertexShader:basicVertexShader,
    //片元着色器，这里设置颜色
  fragmentShader:basicFragmentShader
});
```

原始着色器RawShaderMaterial

```js
attribute 关联顶点的位置，uv
uniform 所有定点相同的数据，如灯光，雾，阴影贴图
varying 顶点着色器传递到片元着色器的变量
```

浮点数精度

```js
highp -2^16~2^16
mediump -2^10~2^10
lowp -2^8~2^8
```

顶点着色器

```js
precision lowp float;//浮点数低精度计算

attribute vec3 position;// 属性，3维的

attribute vec2 uv;// 导入uv属性，2维的
//相同的属性
uniform mat4 modelMatrix;
uniform mat4 viewMatrix;
uniform mat4 projectionMatrix;

varying vec2 vUv;//传给片源着色器
```

片元着色器

```js
varying vec2 vUv;//传入顶点的uv值

gl_FragColor = vec4(vUv, 0.0, 1.0);设置uv值为颜色前两项
```



```js
const rawShaderMaterial = new THREE.RawShaderMaterial({
    //使用着色器
  vertexShader: basicVertexShader,
  fragmentShader: basicFragmentShader,
  //   wireframe: true,//线性显示
  side: THREE.DoubleSide,//两面显示
  uniforms: {
    uTime: {
      value: 0,
    },
    uTexture: {
      value: texture,
    },
  },
});
```

### 光效流动

datav

### uv



![image-20221108093156357](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221108093156357.png)

### outline

outline报错

```js
vPosition = mvPosition;
添加vec4 worldPosition = vec4( transformed,1.0 ) ;
```



```js
OutlinePass.visibleEdgeColor = new THREE.Color(0, 1, 0); //设置显示的颜色
OutlinePass.hiddenEdgeColor = new THREE.Color(1, 1, 0); //设置遮挡的颜色
OutlinePass.edgeGlow = 1.0;
OutlinePass.usePatternTexture = false; //是否显示贴图
OutlinePass.edgeThickness = 10.0; //宽度
OutlinePass.edgeStrength = 6.0; //强度
OutlinePass.downSampleRatio = 2; //
OutlinePass.pulsePeriod = 10; //闪烁速度
```

