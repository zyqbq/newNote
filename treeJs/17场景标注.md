### `CSS2DRenderer.js`

通过`CSS2DObject`类，可以把一个HTML元素转化为一个类似threejs网格模型的对象

```js
// 引入CSS2渲染器CSS2DRenderer和CSS2模型对象CSS2DObject
import { CSS2DRenderer,CSS2DObject } from 'three/addons/renderers/CSS2DRenderer.js';

const div = document.getElementById('tag');
// HTML元素转化为threejs的CSS2模型对象
const tag = new CSS2DObject(div);
tag.position.set(50,0,50);
scene.add(tag);
或
const group = new THREE.Group();
group.add(tag);
```

### CSS2渲染器`CSS2DRenderer`

```js
// 引入CSS2渲染器CSS2DRenderer
import { CSS2DRenderer } from 'three/addons/renderers/CSS2DRenderer.js';
// 创建一个CSS2渲染器CSS2DRenderer
const css2Renderer = new CSS2DRenderer();

// css2Renderer用法和webgl渲染器渲染方法类似
css2Renderer.render(scene, camera);
// width, height：canvas画布宽高度
css2Renderer.setSize(width, height);

//插入到web网页中
//CSS2Renderer.domElement对应的就是<div id="tag"></div>外面的父元素。
document.body.appendChild(css2Renderer.domElement);

//css2render和canvas画布重合
css2Renderer.domElement.style.position = 'absolute';
css2Renderer.domElement.style.top = '0px';
```

### 遮挡问题

解决HTML元素标签对threejs canvas画布鼠标事件的遮挡。

```js
css2Renderer.domElement.style.pointerEvents = 'none';
//子标签设置可以点击
document.getElementById('close').style.pointerEvents = 'auto';
```

###  CSS属性`z-index`

### Canvas尺寸变化，HTML标签

```javascript
// 画布跟随窗口变化
window.onresize = function () {
    const width = window.innerWidth;
    const height = window.innerHeight;
    // cnavas画布宽高度重新设置
    renderer.setSize(width,height);
    // 相机参数重新设置
    camera.aspect = width / height;
    camera.updateProjectionMatrix();
};
```

### 标签设置到模型位置

```javascript
const worldPosition = new THREE.Vector3();
// 获取mesh的世界坐标(meshGroup.position和mesh.position累加结果)
mesh.getWorldPosition(worldPosition);
// mesh世界坐标复制给tag
tag.position.copy(worldPosition);
```

为了世界坐标的一致性，可以将tag添加到mesh中

```javascript
// HTML元素转化为threejs的CSS2模型对象
const tag = new CSS2DObject(div);
//标签tag作为mesh子对象，默认受到父对象位置影响
mesh.add(tag);
```

### 标签位置和局部坐标系一致

也可以在建模软件中使用空对象，将空对象放在要标注的模型下

### HTML标签渲染前隐藏

CSS2渲染器默认会把标签设置为`display: block;`

```html
<!-- CSS2渲染器渲染器之前，隐藏标签 -->
<div id="tag" style="display: none;"><>
```

# CSS3DRenderer

旋转缩放都会跟随变换

标签不会被遮挡

```javascript
// 引入CSS3渲染器CSS3DRenderer
import {CSS3DRenderer} from 'three/addons/renderers/CSS3DRenderer.js';

// 创建一个CSS3渲染器CSS3DRenderer
const css3Renderer = new CSS3DRenderer();
css3Renderer.setSize(width, height);
// HTML标签<div id="tag"></div>外面父元素叠加到canvas画布上且重合
css3Renderer.domElement.style.position = 'absolute';
css3Renderer.domElement.style.top = '0px';
//设置.pointerEvents=none，解决HTML元素标签对threejs canvas画布鼠标事件的遮挡
css3Renderer.domElement.style.pointerEvents = 'none';
document.body.appendChild(css3Renderer.domElement);

// 渲染循环
function render() {
    css3Renderer.render(scene, camera);
    // ...
    requestAnimationFrame(render);
}

window.onresize = function () {
    ...
    // HTML标签css3Renderer.domElement尺寸重新设置
    css3Renderer.setSize(width,height);
};
```

```js
// 引入CSS3模型对象CSS3DObject
import { CSS3DObject } from 'three/addons/renderers/CSS3DRenderer.js';

const div = document.getElementById('tag');
// HTML元素转化为threejs的CSS3模型对象
const tag = new CSS3DObject(div);
//标签tag作为mesh子对象，默认标注在模型局部坐标系坐标原点
mesh.add(tag);
// 相对父对象局部坐标原点偏移80,刚好标注在圆锥
tag.position.y += 80;
```

### 禁止`CSS3DObject`标签对应HTMl元素背面显示

```js
<div id="tag" style="backface-visibility: hidden;">标签内容</div>
```

### CSS3DRenderer渲染的HTML标签尺寸

px值就会转webgl的尺寸

CSS2渲染的标签和CSS3渲染的标签偏移方式不同，CSS3标签，直接按照threejs模型尺寸修改方式改变，比用HTML像素方式更方便准确。

```js
tag.scale.set(0.5,0.5,1);//缩放标签尺寸
tag.position.y += 10;//累加标签高度一半，标签底部和圆锥顶部标注位置重合
```

##  CSS3精灵模型

和精灵网格模型类似，正对canvas画布

```js
// 引入CSS3精灵模型对象CSS3DSprite
import { CSS3DSprite } from 'three/addons/renderers/CSS3DRenderer.js';

const div = document.getElementById('tag');
// HTML元素转化为threejs的CSS3精灵模型`CSS3DSprite`
const tag = new CSS3DSprite(div);
//标签tag作为mesh子对象，默认标注在模型局部坐标系坐标原点
mesh.add(tag);
// 相对父对象局部坐标原点偏移80,刚好标注在圆锥
tag.position.y += 80;
```

### css3Renderer遮挡问题

css3Renderer.domElement和tag都要设置pointerEvents

```js
css3Renderer.domElement.style.pointerEvents = 'none';
```

```js
const div = document.getElementById('tag');
// HTML元素转化为threejs的CSS3模型对象
const tag = new CSS3DObject(div);
// new CSS3DObject(div);之后设置style.pointerEvents 
div.style.pointerEvents = 'none';
```

### 多个标注

```js
 for (let i = 0; i < arr.length; i++) {
        // 注意是多个标签，需要克隆复制一份
        const div = document.getElementById('tag').cloneNode();
        div.innerHTML = arr[i];//标签数据填写
        // HTML元素转化为threejs的CSS3对象
        // const tag = new CSS3DObject(div);
        const tag = new CSS3DSprite(div);
        div.style.pointerEvents = 'none'; //避免标签遮挡canvas鼠标事件
        // obj是建模软件中创建的一个空对象
        const obj = gltf.scene.getObjectByName(arr[i]+'标注');
        //tag会标注在空对象obj对应的位置
        obj.add(tag);
    
        tag.scale.set(0.1,0.1,1);//适当缩放模型标签
        tag.position.y = 40/2*0.1;//标签底部箭头和空对象标注点重合：偏移高度像素值一半*缩放比例
    }
```

### Sprite标签(Canvas作为贴图)

```javascript
const canvas = createCanvas('设备A');//创建一个canvas画布
  // canvas画布作为CanvasTexture的参数创建一个纹理对象
  // 本质上你可以理解为CanvasTexture读取参数canvas画布上的像素值
  const texture = new THREE.CanvasTexture(canvas);
  const spriteMaterial = new THREE.SpriteMaterial({
    map: texture,
  });
```